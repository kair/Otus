<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Otus Monitoring Tool</title>
    <link rel="stylesheet" type="text/css" href="../lib/css/jquery.ui.css"/>
    <link rel="stylesheet" type="text/css" href="../lib/css/jquery.jqplot.min.css"/>    
    <link rel="stylesheet" type="text/css" href="../lib/jcalendar/css/jscal2.css" />
    <link rel="stylesheet" type="text/css" href="../lib/jcalendar/css/border-radius.css" />
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../excanvas.min.js"></script><![endif]-->
    <script language="javascript" type="text/javascript" src="../lib/jquery/jquery.js"></script>
    <script language="javascript" type="text/javascript" src="../lib/jquery/jquery.jqplot.js"></script>
    <script language="javascript" type="text/javascript" src="../lib/jquery/jquery.ui.min.js"></script>
	<script type="text/javascript" src="../lib/jquery/plugins/jqplot.cursor.min.js"></script>
	<script type="text/javascript" src="../lib/jquery/plugins/jqplot.dateAxisRenderer.min.js"></script>
	<script type="text/javascript" src="../lib/jquery/plugins/jqplot.highlighter.min.js"></script>
	<script type="text/javascript" src="../lib/jquery/plugins/jqplot.canvasTextRenderer.min.js"></script>
	<script type="text/javascript" src="../lib/jquery/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>	
    <script language="javascript" type="text/javascript" src="../lib/jcalendar/js/jscal2.js"></script>
	<script language="javascript" type="text/javascript" src="../lib/jcalendar/js/lang/en.js"></script>
	<script language="javascript" type="text/javascript" src="../lib/tsd/configuration.js"></script> 	
  	<script language="javascript" type="text/javascript" src="../lib/tsd/util.js"></script> 	
 	<script language="javascript" type="text/javascript" src="../lib/tsd/query.js"></script>
 </head>
 <body>
 	<div>
    <h1>Cluster Overview</h1>
 		
    Time Range From <input size="20" id="cs" name="cs" value="2011/06/20-17:00:00"/><button id="cs_btn" type="button">...</button>
    To   <input size="20" id="ce" name="ce" value="2011/06/20-17:20:00"/><button id="ce_btn" type="button">...</button>
    <script type="text/javascript">//<![CDATA[
       var cal = Calendar.setup({
          onSelect: function(cal) { cal.hide() },
          showTime: true,
          minuteStep: 1
      });
      cal.manageFields("cs_btn", "cs", "%Y/%m/%d-%H:%M:%S");
      cal.manageFields("ce_btn", "ce", "%Y/%m/%d-%H:%M:%S");
    //]]></script>
    <br>
    Metric Name <input type="text" size="20" id="metric" name="metric" value="cpu_user"/>
    MapReduce Job ID <input type="text" size="20" id="mrjobid" name="mrjobid"/>
	<button type="button" onclick=freshAll()> Go </button>
	</div>
    <div id="clusterview" style="font-size:150%;width:800px;height:600px;"></div>
    
    <script type="text/javascript">
    	// Initialize jobid suggestion

    	$("#metric").autocomplete( {
    		delay: 100,
    		source: MetricList
    	});
    	
    	$("#mrjobid").autocomplete( {
    		delay: 100,
    		source: function(request, response) {
    			$.getJSON(SuggestURL+"&term="+request.term+"&callback=?", function(data) {
    				response(data);	
    			});
    		}
    	});
    	
    	// Initialize cluster view
		var conf = new Object();
    	conf.metric = "cpu_user";
    	conf.aggfunc = "sum";
    	conf.isRate = false;
    	conf.downSampe = null;
    	conf.proclist = ["DataNode", "TaskTracker"];
    	conf.joblist = [];
    	renderView($("#cs").val(), $("#ce").val(), getClusterView, conf, "clusterview");
    	
    	function freshAll() {
    		conf.metric = $("#metric").val();
    		var jobid = $("#mrjobid").val();
    		if (jobid != null && jobid != "") {
    			conf.joblist = [$("#mrjobid").val()];
    		} else {
    			conf.joblist = [];
    		}   		
	   		renderView($("#cs").val(), $("#ce").val(), getClusterView, conf, "clusterview");    		
    	}
    </script>
 </body>
</html>
